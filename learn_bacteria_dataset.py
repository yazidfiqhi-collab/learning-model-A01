# -*- coding: utf-8 -*-
"""Learn-Bacteria-Dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17HacF9hF8aOkT5P4aDvLPKvHn_n_1QNU

#Import Package
"""

import numpy as np # linear algebra
import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)

import warnings
warnings.filterwarnings("ignore")

import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split

from sklearn.feature_extraction.text import CountVectorizer
from sklearn.feature_extraction.text import TfidfTransformer

from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import AdaBoostClassifier
from sklearn.ensemble import ExtraTreesClassifier
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.linear_model import LogisticRegression
from xgboost import XGBClassifier

from sklearn.metrics import accuracy_score, confusion_matrix, classification_report

"""#Import File"""

!mkdir data
!wget -P data/ https://raw.githubusercontent.com/yazidfiqhi-collab/learning-model-A01/main/bacteria_list_200.csv

"""#Tampilkan Data"""

df = pd.read_csv ("data/bacteria_list_200.csv")
df

df.shape

df.info()

df.describe()

"""#Cek dan Menangani Duplikasi atau Missing Value"""

df.isnull().sum()

df.duplicated().sum()

df["Name"].unique()

df["Name"].value_counts()

df[df["Name"] == "Coxiella burnetii"]

df = df.drop_duplicates(subset=["Name"], keep = "first")

df[df["Name"] == "Coxiella burnetii"]

df["Name"].value_counts()

df["Family"].unique()

df["Family"].value_counts()

df[df["Family"] == "Enterobacteriaceae"]

df["Where Found"].unique()

df["Where Found"].value_counts()

df.duplicated().sum()

df.isnull().sum()

#df["Description"] = df["Name"] + " " + df["Family"] + " " + df["Where Found"]
#df["Description"]

df["Description"] = df["Name"] + " " + df["Family"] + " " + df["Where Found"]
display(df.head())

"""##Melihat Jumlah Setiap Kolom"""

for col in ['Family', 'Where Found', 'Harmful to Humans']:
    print(f"Value counts for {col}:")
    print(df[col].value_counts())
    print("\n")

"""#Membuat Model

##Membuat Training Model
"""

X = df.drop('Harmful to Humans', axis=1)
y = df['Harmful to Humans']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

print("Shape of X_train:", X_train.shape)
print("Shape of X_test:", X_test.shape)
print("Shape of y_train:", y_train.shape)
print("Shape of y_test:", y_test.shape)

count_vect = CountVectorizer()
X_train_counts = count_vect.fit_transform(df.iloc[:, -1].values)

le = LabelEncoder()
df["Harmful to Humans"] = le.fit_transform(df["Harmful to Humans"].values)

y = df.iloc[:, -2].values

x_train, x_test, y_train, y_test = train_test_split(X_train_counts, y, random_state=42, test_size=0.2)

tf_transformer = TfidfTransformer(use_idf=False).fit(X_train_counts)
X_train_tf = tf_transformer.transform(x_train)
X_test_tf = tf_transformer.transform(x_test)

def training(model, name, axes):
    model.fit(X_train_tf, y_train)
    pred = model.predict(X_test_tf)
    score = accuracy_score(y_test, pred)
    report = classification_report(y_test, pred)
    cm = confusion_matrix(y_test, pred)
    sns.heatmap(cm, annot=True, ax=axes)
    axes.set_title("{}: {}%".format(name, round(score*100, 2)))
    return score*100, report

"""##Membuat Beberapa Model Machine Learning dan Membandingkan yang Terbaik"""

rfc = RandomForestClassifier()
abc = AdaBoostClassifier(learning_rate=0.1)
etc = ExtraTreesClassifier()
gbc = GradientBoostingClassifier()
lgr = LogisticRegression()
xgb = XGBClassifier()

models = [rfc, abc, etc, gbc, lgr, xgb]
names = ["Random Forest", "Ada Boost", "Extra Trees",
        "Gradient Boosting", "Logistic Regression", "XGBoost"]

scores = []
reports = []
fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(10, 6))
index = 0
for i in range(2):
    for j in range(3):
        score, report = training(models[index], names[index], axes[i][j])
        index += 1
        scores += [score]
        reports += [report]

plt.tight_layout()
plt.show()

dt = pd.DataFrame({"scores": scores}, index=names)
dt = dt.sort_values("scores", ascending=False)
fig, axes = plt.subplots()
dt["scores"] = round(dt["scores"], 2)
sns.barplot(x=dt.index, y=dt.iloc[:, 0], ax=axes)
for container in axes.containers:
    axes.bar_label(container)
axes.set_xticklabels(axes.get_xticklabels(), rotation=90)
plt.show()

for i, j in zip(names, reports):
    print("*"*30)
    print(i)
    print(j)
    print("\n\n")

"""Berikut adalah penjelasan dari output kode sebelumnya:

Output di atas menampilkan laporan klasifikasi dan skor akurasi untuk setiap model yang telah dilatih.

*   **Nama Model**: Random Forest, Ada Boost, Extra Trees, Gradient Boosting, Logistic Regression, dan XGBoost adalah model klasifikasi yang digunakan untuk mendeteksi bakteri berbahaya.
*   **Precision**: Menunjukkan seberapa akurat model dalam memprediksi kelas positif.
*   **Recall**: Menunjukkan seberapa baik model menemukan semua instance positif.
*   **F1-score**: Merupakan rata-rata harmonis dari precision dan recall, memberikan keseimbangan antara keduanya.
*   **Support**: Jumlah sampel sebenarnya di setiap kelas (dalam kasus ini, kelas 0 dan 1 untuk 'Harmful to Humans').
*   **Accuracy**: Persentase total prediksi yang benar.
*   **Macro avg**: Rata-rata metrik (precision, recall, f1-score) untuk setiap kelas, tanpa mempertimbangkan jumlah sampel di setiap kelas.
*   **Weighted avg**: Rata-rata metrik (precision, recall, f1-score) untuk setiap kelas, dengan mempertimbangkan jumlah sampel di setiap kelas (bobot berdasarkan 'support').

Dengan melihat output ini, Anda dapat membandingkan kinerja setiap model dalam mengklasifikasikan bakteri berbahaya berdasarkan metrik-metrik yang ditampilkan. Model dengan skor akurasi dan F1-score yang lebih tinggi umumnya dianggap lebih baik.

## Kesimpulan

Berdasarkan hasil pelatihan dan evaluasi model klasifikasi untuk mendeteksi bakteri berbahaya, didapatkan beberapa temuan kunci:

1.  **Model Terbaik**: Dari perbandingan berbagai model yang diuji (Random Forest, Ada Boost, Extra Trees, Gradient Boosting, Logistic Regression, dan XGBoost), **Logistic Regression** menunjukkan kinerja terbaik dengan akurasi tertinggi sebesar 82.05%. Model ini juga memiliki keseimbangan yang baik antara *precision* dan *recall* untuk kedua kelas (berbahaya dan tidak berbahaya), seperti terlihat dari nilai F1-score yang relatif tinggi.

2.  **Model Lain**:
    *   **Extra Trees** dan **Gradient Boosting** juga menunjukkan kinerja yang cukup baik, menempati posisi kedua dan ketiga dalam hal akurasi.
    *   Model **Random Forest**, **XGBoost**, dan **Ada Boost** memiliki akurasi yang lebih rendah dibandingkan model-model lainnya dalam kasus ini.

3.  **Analisis Metrik**:
    *   Melihat laporan klasifikasi, terlihat bahwa beberapa model (seperti Random Forest dan Ada Boost) memiliki *recall* yang tinggi untuk kelas 0 (tidak berbahaya) namun *recall* yang rendah untuk kelas 1 (berbahaya). Ini berarti model-model tersebut cenderung memprediksi banyak bakteri sebagai tidak berbahaya, bahkan jika sebenarnya berbahaya.
    *   Sebaliknya, model seperti Logistic Regression menunjukkan keseimbangan yang lebih baik dalam mengidentifikasi kedua kelas.

4.  **Pentingnya Pemilihan Model**: Hasil ini menekankan pentingnya membandingkan berbagai model untuk menemukan yang paling sesuai dengan karakteristik data dan tujuan klasifikasi. Dalam kasus ini, Logistic Regression terbukti paling efektif untuk membedakan bakteri berbahaya dan tidak berbahaya berdasarkan fitur yang digunakan.

Secara keseluruhan, meskipun dataset yang digunakan relatif kecil, model Logistic Regression menunjukkan potensi yang menjanjikan untuk tugas deteksi bakteri berbahaya. Untuk meningkatkan kinerja lebih lanjut, mungkin diperlukan eksplorasi fitur tambahan, *tuning* parameter model, atau penggunaan dataset yang lebih besar dan lebih bervariasi.

## Informasi dari Data Bakteri

Berdasarkan pengolahan data yang telah dilakukan, berikut adalah beberapa informasi penting yang didapatkan dari dataset bakteri:

1.  **Jumlah Data dan Kolom**: Dataset berisi 194 sampel bakteri dengan 4 kolom utama: "Name", "Family", "Where Found", dan "Harmful to Humans".
2.  **Tidak Ada Nilai yang Hilang (Missing Values)**: Semua kolom dalam dataset lengkap dan tidak memiliki nilai yang hilang, yang berarti data siap untuk digunakan dalam pemodelan tanpa perlu penanganan *missing values*.
3.  **Tidak Ada Duplikasi Data**: Setelah menghapus duplikasi berdasarkan nama bakteri, dataset tidak lagi mengandung baris yang identik.
4.  **Keberagaman Bakteri**: Dataset mencakup 194 nama bakteri unik dan 92 famili bakteri yang berbeda, menunjukkan variasi dalam jenis bakteri yang ada.
5.  **Keberagaman Lokasi Ditemukan**: Bakteri dalam dataset ditemukan di 119 lokasi yang berbeda, memberikan gambaran tentang habitat alami bakteri tersebut.
6.  **Distribusi Bakteri Berbahaya vs Tidak Berbahaya**: Terdapat 102 bakteri yang diklasifikasikan sebagai "Tidak Berbahaya" (No) dan 92 bakteri sebagai "Berbahaya" (Yes), menunjukkan adanya sedikit ketidakseimbangan kelas.
7.  **Informasi Gabungan (Description)**: Kolom baru "Description" berhasil dibuat dengan menggabungkan nama bakteri, famili, dan lokasi ditemukan. Kolom ini digunakan sebagai fitur teks untuk melatih model klasifikasi.
8.  **Vektorisasi Data Teks**: Data teks pada kolom "Description" telah berhasil diubah menjadi representasi numerik menggunakan CountVectorizer dan TfidfTransformer, menghasilkan matriks fitur dengan 194 sampel dan 570 fitur.
9.  **Pembagian Data Latih dan Uji**: Data telah dibagi menjadi set pelatihan (155 sampel) dan set pengujian (39 sampel) untuk melatih dan mengevaluasi model.
10. **Kinerja Model Klasifikasi**:
    *   Berbagai model klasifikasi telah dilatih dan dievaluasi untuk memprediksi apakah bakteri berbahaya atau tidak.
    *   Model **Logistic Regression** menunjukkan kinerja terbaik dalam hal akurasi (82.05%), serta keseimbangan yang baik dalam mengidentifikasi kedua kelas (berbahaya dan tidak berbahaya) berdasarkan metrik precision, recall, dan F1-score.
    *   Model lain seperti Extra Trees dan Gradient Boosting juga menunjukkan kinerja yang cukup baik.
    *   Beberapa model (misalnya Random Forest dan Ada Boost) cenderung memiliki bias dalam memprediksi kelas, dengan recall yang tinggi untuk kelas tidak berbahaya tetapi rendah untuk kelas berbahaya.

Secara keseluruhan, data ini memberikan dasar yang baik untuk membangun model klasifikasi yang dapat memprediksi potensi bahaya suatu bakteri berdasarkan nama, famili, dan lokasi ditemukannya. Analisis awal menunjukkan bahwa model seperti Logistic Regression cukup efektif untuk tugas ini.
"""